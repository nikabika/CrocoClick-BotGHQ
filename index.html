<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GreenChat</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Futura:wght@600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body {
            background-color: #000000;
            font-family: 'Futura', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
            font-weight: 600;
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: #ffffff;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .header {
            background-color: #000000;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
            z-index: 10;
            cursor: pointer;
        }

        .header-text {
            font-size: 18px;
            letter-spacing: -0.5px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .header-text:hover {
            transform: scale(1.05);
        }

        .header-text i {
            font-size: 16px;
            opacity: 0.7;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .header-text.active i {
            transform: rotate(180deg);
        }

        .model-selector {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background-color: #1c1c1e;
            border-radius: 12px;
            padding: 8px 0;
            min-width: 200px;
            max-height: 280px; /* 4 модели + токен поле */
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: top center;
            overflow-y: auto;
        }

        .model-selector::-webkit-scrollbar {
            width: 6px;
        }

        .model-selector::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 3px;
        }

        .model-selector::-webkit-scrollbar-thumb {
            background: #BBFE26;
            border-radius: 3px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .model-selector::-webkit-scrollbar-thumb:hover {
            background: #a8e520;
            transform: scale(1.1);
        }

        .model-selector.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1);
        }

        .model-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-size: 14px;
            transform: translateX(-10px);
            opacity: 0;
        }

        .model-selector.show .model-option {
            transform: translateX(0);
            opacity: 1;
        }

        .model-selector.show .model-option:nth-child(2) { transition-delay: 0.05s; }
        .model-selector.show .model-option:nth-child(3) { transition-delay: 0.1s; }
        .model-selector.show .model-option:nth-child(4) { transition-delay: 0.15s; }
        .model-selector.show .model-option:nth-child(5) { transition-delay: 0.2s; }
        .model-selector.show .model-option:nth-child(6) { transition-delay: 0.25s; }
        .model-selector.show .model-option:nth-child(7) { transition-delay: 0.3s; }

        .model-option:hover {
            background-color: #2c2c2e;
            transform: translateX(5px);
        }

        .model-option.active {
            background-color: #BBFE26;
            color: #000000;
        }

        .token-input-container {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(-10px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            opacity: 0.5;
        }

        .model-selector.show .token-input-container {
            transform: translateY(0);
            opacity: 0.5;
        }

        .token-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            color: #ffffff;
            font-size: 12px;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
        }

        .token-input:focus {
            transform: scale(1.02);
            border-color: #BBFE26;
        }

        .token-input::placeholder {
            color: #8e8e93;
        }

        .content {
            flex: 1;
            overflow: hidden;
            position: relative;
            padding: 10px 20px;
        }

        .messages-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%;
            overflow-y: auto;
            padding-right: 5px;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 3px;
            margin: 5px 0;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: #BBFE26;
            border-radius: 3px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
            background: #a8e520;
            transform: scale(1.1);
        }

        .message {
            background-color: #2c2c2e;
            border-radius: 15px;
            padding: 12px 16px;
            max-width: 85%;
            font-size: 16px;
            line-height: 1.4;
            position: relative;
            animation: messageAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-y: auto;
            max-height: 300px;
            transform-origin: bottom;
        }

        .message.user {
            background-color: #BBFE26;
            color: #000000;
            align-self: flex-end;
            border-radius: 15px 15px 5px 15px;
            transform-origin: bottom right;
        }

        .message.assistant {
            background-color: #2c2c2e;
            color: #ffffff;
            align-self: flex-start;
            border-radius: 15px 15px 15px 5px;
            transform-origin: bottom left;
        }

        .message.thinking {
            opacity: 0.7;
            font-style: italic;
        }

        .message::-webkit-scrollbar {
            width: 4px;
        }

        .message::-webkit-scrollbar-track {
            background: transparent;
            margin: 2px 0;
        }

        .message::-webkit-scrollbar-thumb {
            background: #8e8e93;
            border-radius: 2px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .message::-webkit-scrollbar-thumb:hover {
            background: #BBFE26;
            transform: scale(1.2);
        }

        @keyframes messageAppear {
            0% {
                opacity: 0;
                transform: scale(0.7) translateY(20px);
            }
            70% {
                transform: scale(1.05) translateY(-5px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .footer {
            background-color: #000000;
            padding: 0px 20px 15px 20px;
            flex-shrink: 0;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .input-container {
            display: flex;
            align-items: flex-end;
            background-color: #1c1c1e;
            border-radius: 15px;
            padding: 12px 16px;
            max-width: 100%;
            margin: 0 auto;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            min-height: 54px;
        }

        .input-container:focus-within {
            background-color: #2c2c2e;
            transform: scale(1.02);
        }

        .input-container.has-text {
            padding-right: 55px;
        }

        .input-container.expanded {
            min-height: 54px;
            max-height: 120px;
            overflow-y: auto;
        }

        .chat-input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: #ffffff;
            font-size: 16px;
            font-family: 'Futura', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            resize: none;
            min-height: 24px;
            max-height: 90px;
            overflow-y: auto;
            line-height: 1.4;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .chat-input.has-text {
            margin-right: 45px;
        }

        .chat-input::placeholder {
            color: #8e8e93;
        }

        .chat-input:disabled {
            opacity: 0.5;
        }

        .send-button {
            position: absolute;
            right: 7px;
            bottom: 8px;
            background-color: #BBFE26;
            border: none;
            border-radius: 13px;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transform: scale(0.5) rotate(-90deg);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            flex-shrink: 0;
        }

        .send-button.visible {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .send-button:hover:not(:disabled) {
            background-color: #a8e520;
            transform: scale(1.1) rotate(5deg);
        }

        .send-button:active:not(:disabled) {
            transform: scale(0.95) rotate(0deg);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-icon {
            color: #000000;
            font-size: 18px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .error-message {
            background-color: #ff3b30;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            font-size: 14px;
            align-self: center;
            max-width: 80%;
            text-align: center;
            animation: errorAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center;
        }

        @keyframes errorAppear {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(-20px);
            }
            70% {
                transform: scale(1.1) translateY(5px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .typing-dots {
            display: inline-block;
        }

        .typing-dots span {
            animation: typing 1.4s infinite ease-in-out;
            display: inline-block;
            opacity: 0.6;
        }

        .typing-dots span:nth-child(1) { animation-delay: 0s; }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-5px); opacity: 1; }
        }

        .api-info {
            padding: 8px 16px;
            font-size: 10px;
            color: #8e8e93;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="header" id="header">
        <div class="header-text" id="headerText">
            GreenChat
            <i class="ti ti-chevron-down"></i>
        </div>
        <div class="model-selector" id="modelSelector">
            <div class="token-input-container">
                <input type="text" class="token-input" id="apiToken" placeholder="API токен защищен" readonly>
            </div>
            <div class="model-option" data-model="GreenChat">GreenChat (базовая)</div>
            <div class="model-option" data-model="GreenChat v1">GreenChat v1</div>
            <div class="model-option" data-model="GreenChat Turbo">GreenChat Turbo</div>
            <div class="model-option" data-model="GreenChat v2">GreenChat v2</div>
            <div class="model-option" data-model="GreenChat Max">GreenChat Max</div>
            <div class="model-option" data-model="GreenChat Pro">GreenChat Pro</div>
            <div class="api-info">API защищено • v1.0</div>
        </div>
    </div>

    <div class="content">
        <div class="messages-container" id="messagesContainer">
            <!-- Сообщения будут добавляться здесь -->
        </div>
    </div>

    <div class="footer" id="footer">
        <div class="input-container" id="inputContainer">
            <textarea class="chat-input" id="chatInput" placeholder="Спросить GreenChat" rows="1"></textarea>
            <button class="send-button" id="sendButton">
                <i class="ti ti-arrow-up send-icon"></i>
            </button>
        </div>
    </div>

    <script>
        class GreenChat {
            constructor() {
                // Защищенные данные - встроены в код
                this.apiToken = 'LCQXGGwQbGrbjhTGpGMHicaohgzcYaivIL';
                this.apiUrl = 'https://api.hgface.ru/v1/chat/completions'; // IP/URL защищен
                
                this.currentModel = localStorage.getItem('greenchat_model') || 'GreenChat';
                this.isThinking = false;
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateModelDisplay();
                this.disableTokenInput();
            }

            bindEvents() {
                const chatInput = document.getElementById('chatInput');
                const sendButton = document.getElementById('sendButton');
                const inputContainer = document.getElementById('inputContainer');
                const footer = document.getElementById('footer');
                const header = document.getElementById('header');
                const headerText = document.getElementById('headerText');
                const modelSelector = document.getElementById('modelSelector');

                // Выбор модели
                header.addEventListener('click', (e) => {
                    this.toggleModelSelector();
                    e.stopPropagation();
                });

                document.addEventListener('click', (e) => {
                    if (!modelSelector.contains(e.target) && !header.contains(e.target)) {
                        this.hideModelSelector();
                    }
                });

                // Выбор модели из списка
                document.querySelectorAll('.model-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const model = e.target.dataset.model;
                        this.setModel(model);
                        this.hideModelSelector();
                    });
                });

                // Защита от ввода в поле токена
                const apiTokenInput = document.getElementById('apiToken');
                apiTokenInput.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showError('API токен защищен от изменений');
                });

                apiTokenInput.addEventListener('keydown', (e) => {
                    e.preventDefault();
                });

                // Плавное управление клавиатурой
                window.addEventListener('resize', this.handleKeyboard.bind(this));

                // Закрытие ввода при клике мимо
                document.addEventListener('click', (e) => {
                    if (!inputContainer.contains(e.target) && chatInput === document.activeElement) {
                        chatInput.blur();
                    }
                });

                // Авторазмер текстового поля
                chatInput.addEventListener('input', this.autoResize.bind(this));

                // Фокус/блюр
                chatInput.addEventListener('focus', () => {
                    inputContainer.style.backgroundColor = '#2c2c2e';
                });

                chatInput.addEventListener('blur', () => {
                    inputContainer.style.backgroundColor = '#1c1c1e';
                });

                // Отправка сообщения
                sendButton.addEventListener('click', () => this.sendMessage());

                // Enter для новой строки, Ctrl+Enter для отправки
                chatInput.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Запрет контекстного меню для защиты
                document.addEventListener('contextmenu', (e) => {
                    if (e.target.classList.contains('token-input') || 
                        e.target.classList.contains('model-selector')) {
                        e.preventDefault();
                    }
                });
            }

            disableTokenInput() {
                const apiTokenInput = document.getElementById('apiToken');
                apiTokenInput.value = '••••••••••••••••••••••••••••••';
                apiTokenInput.readOnly = true;
                apiTokenInput.style.cursor = 'not-allowed';
            }

            toggleModelSelector() {
                const modelSelector = document.getElementById('modelSelector');
                const headerText = document.getElementById('headerText');
                
                if (modelSelector.classList.contains('show')) {
                    this.hideModelSelector();
                } else {
                    modelSelector.classList.add('show');
                    headerText.classList.add('active');
                }
            }

            hideModelSelector() {
                const modelSelector = document.getElementById('modelSelector');
                const headerText = document.getElementById('headerText');
                
                modelSelector.classList.remove('show');
                headerText.classList.remove('active');
            }

            handleKeyboard() {
                setTimeout(() => {
                    const visualViewport = window.visualViewport;
                    const footer = document.getElementById('footer');
                    
                    if (visualViewport) {
                        const keyboardHeight = window.innerHeight - visualViewport.height;
                        
                        if (keyboardHeight > 100) {
                            footer.style.transform = `translateY(-${keyboardHeight}px)`;
                        } else {
                            footer.style.transform = '';
                        }
                    }
                }, 100);
            }

            autoResize() {
                const chatInput = document.getElementById('chatInput');
                const inputContainer = document.getElementById('inputContainer');
                const sendButton = document.getElementById('sendButton');

                chatInput.style.height = 'auto';
                const newHeight = Math.min(chatInput.scrollHeight, 90);
                chatInput.style.height = newHeight + 'px';

                if (chatInput.scrollHeight > 54) {
                    inputContainer.classList.add('expanded');
                    chatInput.style.overflowY = 'auto';
                } else {
                    inputContainer.classList.remove('expanded');
                    chatInput.style.overflowY = 'hidden';
                }

                if (chatInput.value.trim().length > 0) {
                    inputContainer.classList.add('has-text');
                    chatInput.classList.add('has-text');
                    sendButton.classList.add('visible');
                } else {
                    inputContainer.classList.remove('has-text');
                    chatInput.classList.remove('has-text');
                    sendButton.classList.remove('visible');
                }
            }

            setModel(model) {
                this.currentModel = model;
                localStorage.setItem('greenchat_model', model);
                this.updateModelDisplay();
            }

            updateModelDisplay() {
                const headerText = document.getElementById('headerText');
                headerText.innerHTML = `${this.currentModel} <i class="ti ti-chevron-down"></i>`;
                
                // Обновляем активную модель в селекторе
                document.querySelectorAll('.model-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.model === this.currentModel) {
                        option.classList.add('active');
                    }
                });
            }

            async sendMessage() {
                if (this.isThinking) return;

                const chatInput = document.getElementById('chatInput');
                const message = chatInput.value.trim();

                if (!message) return;

                this.isThinking = true;
                this.setUIState(true);

                // Добавляем сообщение пользователя
                this.addMessage(message, 'user');
                chatInput.value = '';
                this.autoResize();

                // Добавляем индикатор "думает" с анимированными точками
                const thinkingId = this.addMessage('Думаю<span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>', 'assistant thinking');

                try {
                    const response = await this.callHGFaceAPI(message);
                    this.replaceMessage(thinkingId, response, 'assistant');
                } catch (error) {
                    console.error('API Error:', error);
                    this.replaceMessage(thinkingId, `Ошибка соединения с API. Попробуйте позже.`, 'assistant');
                } finally {
                    this.isThinking = false;
                    this.setUIState(false);
                }
            }

            setUIState(thinking) {
                const chatInput = document.getElementById('chatInput');
                const sendButton = document.getElementById('sendButton');

                chatInput.disabled = thinking;
                sendButton.disabled = thinking;

                if (thinking) {
                    sendButton.innerHTML = '<i class="ti ti-loader send-icon"></i>';
                } else {
                    sendButton.innerHTML = '<i class="ti ti-arrow-up send-icon"></i>';
                }
            }

            async callHGFaceAPI(message) {
                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiToken}`
                    },
                    body: JSON.stringify({
                        model: this.getModelCode(),
                        messages: [
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            getModelCode() {
                const modelMap = {
                    'GreenChat': 'greenchat-base',
                    'GreenChat v1': 'greenchat-v1',
                    'GreenChat Turbo': 'greenchat-turbo',
                    'GreenChat v2': 'greenchat-v2',
                    'GreenChat Max': 'greenchat-max',
                    'GreenChat Pro': 'greenchat-pro'
                };
                return modelMap[this.currentModel] || 'greenchat-base';
            }

            addMessage(text, type = 'user') {
                const messagesContainer = document.getElementById('messagesContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.innerHTML = text;
                messageDiv.dataset.id = Date.now();

                messagesContainer.appendChild(messageDiv);
                // Прокрутка к новому сообщению
                setTimeout(() => {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 100);

                return messageDiv.dataset.id;
            }

            replaceMessage(id, newText, type) {
                const messageDiv = document.querySelector(`.message[data-id="${id}"]`);
                if (messageDiv) {
                    messageDiv.innerHTML = newText;
                    messageDiv.className = `message ${type}`;
                    const messagesContainer = document.getElementById('messagesContainer');
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }

            showError(text) {
                const messagesContainer = document.getElementById('messagesContainer');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = text;

                messagesContainer.appendChild(errorDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                setTimeout(() => {
                    errorDiv.style.opacity = '0';
                    errorDiv.style.transform = 'scale(0.8) translateY(-10px)';
                    setTimeout(() => {
                        errorDiv.remove();
                    }, 300);
                }, 3000);
            }
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            new GreenChat();
        });

        // Дополнительная защита от копирования
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && (e.key === 'u' || e.key === 'U')) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
