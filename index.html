<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ - Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            background-color: #121212;
            color: #FFFFFF;
            padding: 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }

        .back-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #2C2C2E;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .back-icon {
            width: 24px;
            height: 24px;
            color: white;
        }

        .page-title {
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            flex-grow: 1;
            padding: 0 12px;
        }

        .money-indicator {
            background-color: #2C2C2E;
            padding: 8px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        .upgrade-container {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .upgrade-banner {
            background-color: #2C2C2E;
            border-radius: 14px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .upgrade-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 16px;
        }

        .upgrade-emoji {
            font-size: 22px;
            width: 30px;
            text-align: center;
        }

        .upgrade-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 12px;
        }

        .upgrade-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-grow: 1;
        }

        .energy-bars {
            display: flex;
            gap: 3px;
            align-items: flex-end;
            height: 26px;
        }

        .energy-bar {
            width: 6px;
            background-color: #3A3A3C;
            border-radius: 2px;
            transition: background-color 0.2s ease;
        }

        .energy-bar.filled {
            background-color: #40a7e3;
        }

        .bar-1 { height: 8px; }
        .bar-2 { height: 10px; }
        .bar-3 { height: 12px; }
        .bar-4 { height: 14px; }
        .bar-5 { height: 16px; }
        .bar-6 { height: 18px; }
        .bar-7 { height: 20px; }
        .bar-8 { height: 22px; }
        .bar-9 { height: 24px; }
        .bar-10 { height: 26px; }

        .level-text {
            font-size: 12px;
            color: #8E8E93;
            font-weight: 500;
        }

        .upgrade-button {
            padding: 10px 14px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 13px;
            text-align: center;
            cursor: pointer;
            border: none;
            background-color: #40a7e3;
            color: white;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: 110px;
        }

        .upgrade-button:active {
            opacity: 0.8;
            transform: scale(0.98);
        }

        .upgrade-button:disabled {
            background-color: #3A3A3C;
            color: #8E8E93;
            cursor: not-allowed;
            transform: none;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 360px) {
            .upgrade-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .upgrade-button {
                align-self: stretch;
                text-align: center;
            }
            
            .page-title {
                font-size: 16px;
            }
            
            .money-indicator {
                font-size: 13px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="back-button" id="back-button">
            <svg class="back-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M15 6l-6 6l6 6" />
            </svg>
        </div>
        <div class="page-title">–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏</div>
        <div class="money-indicator">
            <span>$</span>
            <span id="money-count">0</span>
        </div>
    </div>

    <div class="upgrade-container">
        <div class="upgrade-banner" id="energy-upgrade">
            <div class="upgrade-header">
                <span class="upgrade-emoji">‚ö°Ô∏è</span>
                <span>–õ–∏–º–∏—Ç —ç–Ω–µ—Ä–≥–∏–∏</span>
            </div>
            <div class="upgrade-content">
                <div class="upgrade-info">
                    <div class="energy-bars" id="energy-bars">
                        <!-- Energy bars will be generated by JavaScript -->
                    </div>
                    <div class="level-text">–£—Ä–æ–≤–µ–Ω—å: <span id="energy-level">1</span>/10</div>
                </div>
                <button class="upgrade-button" id="energy-upgrade-btn">$2500</button>
            </div>
        </div>

        <div class="upgrade-banner" id="autofarm-upgrade">
            <div class="upgrade-header">
                <span class="upgrade-emoji">üí™</span>
                <span>–ê–≤—Ç–æ-—Ñ–∞—Ä–º</span>
            </div>
            <div class="upgrade-content">
                <div class="upgrade-info">
                    <div class="energy-bars" id="autofarm-bars">
                        <!-- Autofarm bars will be generated by JavaScript -->
                    </div>
                    <div class="level-text">–£—Ä–æ–≤–µ–Ω—å: <span id="autofarm-level">0</span>/10</div>
                </div>
                <button class="upgrade-button" id="autofarm-upgrade-btn">$1000</button>
            </div>
        </div>

        <div class="upgrade-banner" id="income-upgrade">
            <div class="upgrade-header">
                <span class="upgrade-emoji">üí≤</span>
                <span>–î–æ—Ö–æ–¥</span>
            </div>
            <div class="upgrade-content">
                <div class="upgrade-info">
                    <div class="energy-bars" id="income-bars">
                        <!-- Income bars will be generated by JavaScript -->
                    </div>
                    <div class="level-text">–£—Ä–æ–≤–µ–Ω—å: <span id="income-level">1</span>/10</div>
                </div>
                <button class="upgrade-button" id="income-upgrade-btn">$1500</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram?.WebApp;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const backButton = document.getElementById('back-button');
        const moneyCount = document.getElementById('money-count');
        const energyBars = document.getElementById('energy-bars');
        const autofarmBars = document.getElementById('autofarm-bars');
        const incomeBars = document.getElementById('income-bars');
        const energyLevel = document.getElementById('energy-level');
        const autofarmLevel = document.getElementById('autofarm-level');
        const incomeLevel = document.getElementById('income-level');
        const energyUpgradeBtn = document.getElementById('energy-upgrade-btn');
        const autofarmUpgradeBtn = document.getElementById('autofarm-upgrade-btn');
        const incomeUpgradeBtn = document.getElementById('income-upgrade-btn');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
        const modifications = {
            energy: {
                level: 1,
                basePrice: 2500,
                priceIncrement: 1200,
                currentPrice: 2500,
                maxLevel: 10
            },
            autofarm: {
                level: 0,
                basePrice: 1000,
                priceIncrement: 1000,
                currentPrice: 1000,
                maxLevel: 10
            },
            income: {
                level: 1,
                basePrice: 1500,
                priceIncrement: 1100,
                currentPrice: 1500,
                maxLevel: 10
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–µ–≥–∫–æ–π –≤–∏–±—Ä–∞—Ü–∏–∏
        function vibrate() {
            if (navigator.vibrate) {
                navigator.vibrate(10);
            } else if (window.Telegram?.WebApp?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
        function setAccentColor() {
            if (tg && tg.themeParams.button_color) {
                const accentColor = tg.themeParams.button_color;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∞–ø–≥—Ä–µ–π–¥–∞
                document.querySelectorAll('.upgrade-button:not(:disabled)').forEach(button => {
                    button.style.backgroundColor = accentColor;
                });
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –±–∞—Ä–æ–≤
                document.querySelectorAll('.energy-bar.filled').forEach(bar => {
                    bar.style.backgroundColor = accentColor;
                });
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —à–∫–∞–ª
        function createBars(container, filledCount, totalCount) {
            container.innerHTML = '';
            
            for (let i = 1; i <= totalCount; i++) {
                const bar = document.createElement('div');
                bar.className = `energy-bar bar-${i} ${i <= filledCount ? 'filled' : ''}`;
                container.appendChild(bar);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
        function updateModifications() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —à–∫–∞–ª—ã
            createBars(energyBars, modifications.energy.level, modifications.energy.maxLevel);
            createBars(autofarmBars, modifications.autofarm.level, modifications.autofarm.maxLevel);
            createBars(incomeBars, modifications.income.level, modifications.income.maxLevel);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–Ω–∏
            energyLevel.textContent = modifications.energy.level;
            autofarmLevel.textContent = modifications.autofarm.level;
            incomeLevel.textContent = modifications.income.level;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
            energyUpgradeBtn.textContent = `$${modifications.energy.currentPrice}`;
            autofarmUpgradeBtn.textContent = `$${modifications.autofarm.currentPrice}`;
            incomeUpgradeBtn.textContent = `$${modifications.income.currentPrice}`;
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            if (modifications.energy.level >= modifications.energy.maxLevel) {
                energyUpgradeBtn.disabled = true;
                energyUpgradeBtn.textContent = '–ú–∞–∫—Å. —É—Ä.';
            } else {
                energyUpgradeBtn.disabled = false;
            }
            
            if (modifications.autofarm.level >= modifications.autofarm.maxLevel) {
                autofarmUpgradeBtn.disabled = true;
                autofarmUpgradeBtn.textContent = '–ú–∞–∫—Å. —É—Ä.';
            } else {
                autofarmUpgradeBtn.disabled = false;
            }
            
            if (modifications.income.level >= modifications.income.maxLevel) {
                incomeUpgradeBtn.disabled = true;
                incomeUpgradeBtn.textContent = '–ú–∞–∫—Å. —É—Ä.';
            } else {
                incomeUpgradeBtn.disabled = false;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç
            setAccentColor();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function upgradeModification(type) {
            vibrate();
            
            const mod = modifications[type];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —É–ª—É—á—à–∏—Ç—å (–Ω–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)
            if (mod.level < mod.maxLevel) {
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
                mod.level++;
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ü–µ–Ω—É
                mod.currentPrice = mod.basePrice + (mod.level * mod.priceIncrement);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateModifications();
                
                console.log(`–£–ª—É—á—à–µ–Ω–æ: ${type} –¥–æ —É—Ä–æ–≤–Ω—è ${mod.level}. –ù–æ–≤–∞—è —Ü–µ–Ω–∞: $${mod.currentPrice}`);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º –∞–ø–≥—Ä–µ–π–¥–∞
        energyUpgradeBtn.addEventListener('click', () => upgradeModification('energy'));
        autofarmUpgradeBtn.addEventListener('click', () => upgradeModification('autofarm'));
        incomeUpgradeBtn.addEventListener('click', () => upgradeModification('income'));
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–ù–∞–∑–∞–¥"
        backButton.addEventListener('click', () => {
            vibrate();
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞–∑–∞–¥)
            if (tg && tg.close) {
                tg.close();
            } else {
                // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
                window.history.back();
            }
        });
        
        // –ó–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        document.addEventListener('dragstart', e => e.preventDefault());
        
        // –û—Ç–∫–ª—é—á–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∂–µ—Å—Ç–æ–º –¥–≤–æ–π–Ω–æ–≥–æ —Ç–∞–ø–∞
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            updateModifications();
            
            if (tg) {
                console.log('Telegram WebApp initialized:', tg);
                tg.expand();
            } else {
                console.log('Not in Telegram environment - using mock data');
            }
        });
    </script>
</body>
</html>
