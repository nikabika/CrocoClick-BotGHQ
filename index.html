<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Галерея с Telegram WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #2C2C2E;
            color: #FFFFFF;
            min-height: 100vh;
            overflow: hidden;
            touch-action: none;
            position: relative;
        }
        
        /* Аватарка пользователя */
        .user-avatar {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 16px;
            overflow: hidden;
            z-index: 100;
            background: #48484A;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0A84FF;
            color: white;
            font-weight: 600;
            font-size: 20px;
        }
        
        .gallery-container {
            width: 100%;
            max-width: 100%;
            height: 50vh;
            position: fixed;
            top: 75px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .cards-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card {
            position: absolute;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .center {
            width: 180px;
            height: 250px;
            z-index: 30;
            opacity: 1;
            transform: translateX(0) scale(1);
        }
        
        .right {
            width: 130px;
            height: 180px;
            z-index: 20;
            opacity: 0.7;
            transform: translateX(160px) scale(0.8);
        }
        
        .left {
            width: 130px;
            height: 180px;
            z-index: 20;
            opacity: 0.7;
            transform: translateX(-160px) scale(0.8);
        }

        .hidden {
            opacity: 0;
            transform: translateX(0) scale(0.5);
            pointer-events: none;
            z-index: 5;
            transition: opacity 0.3s ease; /* Только opacity анимируется */
        }

        /* Панель в нижней части экрана */
        .bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: calc(45vh + 45px); /* Увеличена на 45px */
            background-color: #1C1C1E;
            border-top-left-radius: 29px;
            border-top-right-radius: 29px;
            z-index: 10;
        }

        /* Прямоугольник с картинкой справа */
        .image-rectangle {
            position: fixed;
            top: 75px; /* 75px от верха экрана */
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 0 14px 14px 0; /* Левые углы закруглены на 14px */
            overflow: hidden;
            z-index: 90;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .image-rectangle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Адаптивность для мобильных */
        @media (max-width: 480px) {
            .gallery-container {
                height: 45vh;
                top: 60px;
            }
            
            .user-avatar {
                top: 15px;
                left: 15px;
                width: 45px;
                height: 45px;
            }
            
            .center {
                width: 160px;
                height: 220px;
            }
            
            .right, .left {
                width: 110px;
                height: 150px;
                transform: translateX(130px) scale(0.8);
            }
            
            .right {
                transform: translateX(130px) scale(0.8);
            }
            
            .left {
                transform: translateX(-130px) scale(0.8);
            }

            .bottom-panel {
                height: calc(40vh + 45px);
            }
            
            .image-rectangle {
                top: 60px;
                right: 15px;
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 380px) {
            .gallery-container {
                top: 50px;
            }
            
            .user-avatar {
                width: 40px;
                height: 40px;
            }
            
            .center {
                width: 140px;
                height: 200px;
            }
            
            .right, .left {
                width: 100px;
                height: 140px;
                transform: translateX(120px) scale(0.8);
            }
            
            .right {
                transform: translateX(120px) scale(0.8);
            }
            
            .left {
                transform: translateX(-120px) scale(0.8);
            }

            .bottom-panel {
                height: calc(38vh + 45px);
            }
            
            .image-rectangle {
                top: 50px;
                right: 12px;
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 320px) {
            .gallery-container {
                top: 40px;
            }
            
            .user-avatar {
                width: 35px;
                height: 35px;
            }
            
            .center {
                width: 130px;
                height: 180px;
            }
            
            .right, .left {
                width: 90px;
                height: 120px;
                transform: translateX(100px) scale(0.8);
            }
            
            .right {
                transform: translateX(100px) scale(0.8);
            }
            
            .left {
                transform: translateX(-100px) scale(0.8);
            }

            .bottom-panel {
                height: calc(35vh + 45px);
            }
            
            .image-rectangle {
                top: 40px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            z-index: 40;
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Аватарка пользователя -->
    <div class="user-avatar" id="user-avatar">
        <div class="avatar-placeholder">?</div>
    </div>

    <!-- Прямоугольник с картинкой справа -->
    <div class="image-rectangle">
        <img src="https://cdn.qwenlm.ai/f6e892ea-d64c-4028-b7e3-68db70c87da1/4aaeddd3-3ff5-49a0-93a9-a1239ea96326_IMG_5415.png?key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZV91c2VyX2lkIjoiZjZlODkyZWEtZDY0Yy00MDI4LWI3ZTMtNjhkYjcwYzg3ZGExIiwicmVzb3VyY2VfaWQiOiI0YWFlZGRkMy0zZmY1LTQ5YTAtOTNhOS1hMTIzOWVhOTYzMjYiLCJyZXNvdXJjZV9jaGF0X2lkIjpudWxsfQ.vgL5ZUujeaeRwEnLMeF1_tI6ousxDkQ_jFzLvxphvfk&x-oss-process=image/resize,m_mfit,w_320,h_320" alt="Дополнительное изображение">
    </div>

    <!-- Панель в нижней части -->
    <div class="bottom-panel"></div>

    <div class="gallery-container" id="gallery-container">
        <div class="cards-wrapper" id="cards-wrapper">
            <div class="loading">Загрузка картинок...</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gallery = document.getElementById('gallery-container');
            const cardsWrapper = document.getElementById('cards-wrapper');
            const userAvatar = document.getElementById('user-avatar');
            
            // Инициализация Telegram WebApp
            let tg = window.Telegram.WebApp;
            tg.expand(); // Раскрываем на весь экран
            tg.enableClosingConfirmation(); // Включаем подтверждение закрытия
            
            // Загрузка данных пользователя
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                
                // Показываем аватарку если есть
                if (user.photo_url) {
                    userAvatar.innerHTML = `<img src="${user.photo_url}" alt="Аватар">`;
                } else {
                    // Или первые буквы имени
                    const firstName = user.first_name || '';
                    const lastName = user.last_name || '';
                    const initials = (firstName.charAt(0) + (lastName.charAt(0) || '')).toUpperCase();
                    userAvatar.querySelector('.avatar-placeholder').textContent = initials;
                }
            }
            
            // Правильные URL картинок
            const imageUrls = [
                "https://cdn.qwenlm.ai/72327e40-02c9-46e7-a011-0542655a56ad/2e7c07e8-2adf-45af-9228-84d5c942dd29_%D0%A8%D0%A2%D0%A3%D0%A0%D0%9C%D0%9E%D0%92%D0%98%D0%9A_.png?key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZV91c2VyX2lkIjoiNzIzMjdlNDAtMDJjOS00NmU3LWEwMTEtMDU0MjY1NWE1NmFkIiwicmVzb3Vy%2Bd9jaGF0X2lkIjpudWxsfQ.n2ib1vj1Pke2VoDdWfMQfZWDG5XRih8WwowNRV6oyoA&x-oss-process=image/resize,m_mfit,w_320,h_320",
                "https://cdn.qwenlm.ai/72327e40-02c9-46e7-a011-0542655a56ad/7c399af7-1a69-4c00-996f-ca8438a8747c_%D0%91%D0%9E%D0%91%D0%90_%D0%A4%D0%95%D0%A2%D0%A2.png?key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZV91c2VyX2lkIjoiNzIzMjdlNDAtMDJjOS00NmU3LWEwMTEtMDU0MjY1NWE1NmFkIiwicmVzb3VyY2VfaWQiOiI3YzM5OWFmNy0xYTY5LTRjMDAtOTk2Zi1jYTg0MzhhODc0N2MiLCJyZXNvdXJjZV9jaGF0X2lkIjpudWxsfQ.8q-1PBMMKdPT9bpmh0k2IAOtyelpvjMnoL1aXgioGyo&x-oss-process=image/resize,m_mfit,w_320,h_320",
                "https://cdn.qwenlm.ai/72327e40-02c9-46e7-a011-0542655a56ad/ab2095a2-225f-4b0c-b0de-7af788f64043_%D0%AD%D0%98%CC%86%D0%9B%D0%90_%D0%A1%D0%95%D0%9A%D0%A3%D0%A0%D0%90.png?key=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZV91c2VyX2lkIjoiNzIzMjdlNDAtMDJjOS00NmU3LWEwMTEtMDU0MjY1NWE1NmFkIiwicmVzb3VyY2VfaWQiOiJhYjIwOTVhMi0yMjVmLTRiMGMtYjBkZS03YWY3ODhmNjQwNDMiLCJyZXNvdXJjZV9jaGF0X2lkIjpudWxsfQ.UgjRr7VVEjLDIisj1OLpONACN7AmNQgtkW5WalADHOg&x-oss-process=image/resize,m_mfit,w_320,h_320"
            ];

            let cards = [];
            let currentCenterIndex = 0;
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            // Функция для перемешивания массива
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Создание карточек
            function createCards() {
                cardsWrapper.innerHTML = '';
                cards = [];
                
                // Перемешиваем картинки
                const shuffledUrls = shuffleArray([...imageUrls]);
                
                // Создаем 3 карточки
                for (let i = 0; i < 3; i++) {
                    const card = document.createElement('div');
                    card.className = 'card hidden'; // Начинаем со скрытого состояния
                    card.id = `card-${i}`;
                    
                    const img = document.createElement('img');
                    img.src = shuffledUrls[i];
                    img.alt = `Изображение ${i + 1}`;
                    img.onerror = function() {
                        this.style.backgroundColor = '#48484A';
                        this.style.display = 'flex';
                        this.style.justifyContent = 'center';
                        this.style.alignItems = 'center';
                        this.style.color = 'white';
                        this.innerHTML = 'Ошибка загрузки';
                    };
                    
                    card.appendChild(img);
                    cardsWrapper.appendChild(card);
                    cards.push(card);
                }
                
                updateCardsPosition();
            }

            function updateCardsPosition() {
                cards.forEach((card, index) => {
                    card.classList.remove('center', 'left', 'right', 'hidden');
                    
                    if (index === currentCenterIndex) {
                        card.classList.add('center');
                    } else if (index === currentCenterIndex + 1) {
                        card.classList.add('right');
                    } else if (index === currentCenterIndex - 1) {
                        card.classList.add('left');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            }
            
            function nextCard() {
                if (currentCenterIndex < cards.length - 1) {
                    currentCenterIndex++;
                    updateCardsPosition();
                    // Вибрация при перелистывании
                    if (navigator.vibrate) {
                        navigator.vibrate(1);
                    }
                }
            }
            
            function prevCard() {
                if (currentCenterIndex > 0) {
                    currentCenterIndex--;
                    updateCardsPosition();
                    // Вибрация при перелистывании
                    if (navigator.vibrate) {
                        navigator.vibrate(1);
                    }
                }
            }
            
            function setupEventListeners() {
                gallery.addEventListener('mousedown', function(e) {
                    isDragging = true;
                    startX = e.clientX;
                    currentX = startX;
                });
                
                gallery.addEventListener('mousemove', function(e) {
                    if (!isDragging) return;
                    currentX = e.clientX;
                });
                
                gallery.addEventListener('mouseup', function() {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    const diff = startX - currentX;
                    if (Math.abs(diff) > 50) {
                        if (diff > 0) {
                            nextCard();
                        } else {
                            prevCard();
                        }
                    }
                });
                
                gallery.addEventListener('mouseleave', function() {
                    isDragging = false;
                });
                
                gallery.addEventListener('touchstart', function(e) {
                    isDragging = true;
                    startX = e.touches[0].clientX;
                    currentX = startX;
                }, { passive: true });
                
                gallery.addEventListener('touchmove', function(e) {
                    if (!isDragging) return;
                    currentX = e.touches[0].clientX;
                }, { passive: true });
                
                gallery.addEventListener('touchend', function() {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    const diff = startX - currentX;
                    if (Math.abs(diff) > 30) {
                        if (diff > 0) {
                            nextCard();
                        } else {
                            prevCard();
                        }
                    }
                }, { passive: true });
            }

            // Инициализация
            createCards();
            setupEventListeners();
        });
    </script>
</body>
</html>
